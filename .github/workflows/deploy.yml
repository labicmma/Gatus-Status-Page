name: Deploy to VPS

on:
  push:
    branches:
      - main
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: SSH into VPS and pull latest changes
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USER }}
        key: ${{ secrets.VPS_SSH_KEY }}
        script: |
          cd teste/Gatus-Status-Page/
          mkdir worked_ssh_github_actions
          git pull

    - name: Docker run
      run: |
        docker stop gatus-status-page
        docker rm gatus-status-page
        cd .examples/docker-minimal
        docker run -p 8080:8080 --mount type=bind,source="$(pwd)"/config.yaml,target=/config/config.yaml --name gatus-status-page twinproduction/gatus